# Console API Reference

Quick reference for verifying and managing proofs from the browser console.

## Verification Commands

### Verify a Single Proof

```javascript
// Option 1: Verify by session ID (recommended)
await verifyProofById('session-id-here')

// Option 2: Verify with proof object and public signals
const proof = await getProof('session-id-here')
await verifyProof(proof.proof, proof.publicSignals)
```

**Output:**
```
ðŸ” Verifying proof...
Session ID: abc123...
Location: 29.0325 -95.4195
Accuracy: 12.5 m
Timestamp: 2026-01-04T12:34:56.789Z

âœ… PROOF VALID
Public Signals: ["1"]
```

### Verify All Proofs

```javascript
await verifyAllProofs()
```

**Output:**
```
ðŸ” Verifying 3 proofs...

âœ… abc12345... - 1/4/2026, 12:34:56 PM
âœ… def67890... - 1/4/2026, 1:23:45 PM
âŒ ghi24680... - 1/4/2026, 2:45:12 PM

ðŸ“Š Results: 2/3 valid
```

## Data Access Commands

### List All Sessions

```javascript
await dumpGNSS()
```

Shows table with all GNSS sessions (with or without proofs).

### Get All Proofs

```javascript
const proofs = await getAllProofs()
console.log(proofs)
```

Returns array of all sessions that have proofs.

### Get Specific Proof

```javascript
const proof = await getProof('session-id-here')
console.log(proof)
```

Returns:
```json
{
  "session_id": "abc123...",
  "lat": 29.0325,
  "lon": -95.4195,
  "accuracy": 12.5,
  "timestamp": 1704369296789,
  "created_at": 1704369296789,
  "proof": {
    "pi_a": [...],
    "pi_b": [...],
    "pi_c": [...]
  },
  "publicSignals": ["1"]
}
```

## Download Commands

### Download All Proofs

```javascript
await downloadAllProofs()
```

Downloads `proofs-{timestamp}.json` with all proofs.

### Download Single Proof

```javascript
await downloadProof('session-id-here')
```

Downloads `proof-{session-id}.json`.

## Complete Workflow Examples

### Example 1: Generate and Verify

```javascript
// 1. In UI: Select polygon, acquire GNSS, generate proof
// 2. In console: Get the latest proof
const proofs = await getAllProofs()
const latest = proofs[proofs.length - 1]

// 3. Verify it
await verifyProofById(latest.session_id)

// 4. Download it
await downloadProof(latest.session_id)
```

### Example 2: Batch Verification

```javascript
// Verify all proofs and get detailed results
const results = await verifyAllProofs()

// Filter only valid proofs
const validProofs = results.filter(r => r.valid === 'âœ…')
console.log(`${validProofs.length} valid proofs`)

// Download only valid proofs
for (const result of validProofs) {
  await downloadProof(result.session_id)
}
```

### Example 3: Verify Downloaded Proof

If you have a proof file downloaded:

```javascript
// Load the proof file (copy-paste its contents)
const proofData = {
  "session_id": "...",
  "proof": {...},
  "publicSignals": [...]
}

// Verify it
await verifyProof(proofData.proof, proofData.publicSignals)
```

## Public Signals Explained

The `publicSignals` array contains the circuit outputs visible to verifiers:

```javascript
publicSignals: ["1"]  // 1 = inside polygon, 0 = outside
```

In this simple circuit:
- **Public**: Whether point is inside (1) or outside (0)
- **Private**: The exact coordinates (hidden in the proof)

## Verification Keys

The verification happens using:
- **Verification Key**: `/circuits/verification_key.json` (public)
- **Proof**: Generated by prover
- **Public Signals**: Circuit outputs

The verifier learns:
âœ… The polygon vertices (public input)
âœ… Whether the location is inside (public signal)
âŒ The exact coordinates (private, hidden in proof)

## Common Use Cases

### Debug Failed Proof

```javascript
// Get the proof
const proof = await getProof('session-id')

// Check the data
console.log('Location:', proof.lat, proof.lon)
console.log('Public Signals:', proof.publicSignals)

// Verify
const isValid = await verifyProofById(proof.session_id)

// If invalid, check:
// 1. Was the location actually inside the polygon?
// 2. Were the coordinates scaled correctly (Ã—10000)?
// 3. Is the verification key matching the circuit?
```

### Export for External Verification

```javascript
// Download all proofs
await downloadAllProofs()

// Use verify-proof.js in terminal:
// node verify-proof.js proofs-{timestamp}.json
```

### Check Proof Statistics

```javascript
const proofs = await getAllProofs()

console.log('Total proofs:', proofs.length)
console.log('Unique locations:', new Set(proofs.map(p => `${p.lat},${p.lon}`)).size)

// Average accuracy
const avgAccuracy = proofs.reduce((sum, p) => sum + p.accuracy, 0) / proofs.length
console.log('Average accuracy:', avgAccuracy.toFixed(2), 'm')

// Timestamps
console.log('First:', new Date(Math.min(...proofs.map(p => p.timestamp))))
console.log('Last:', new Date(Math.max(...proofs.map(p => p.timestamp))))
```

## Available Functions Summary

| Function | Description |
|----------|-------------|
| `verifyProofById(sessionId)` | Verify proof by session ID (detailed output) |
| `verifyProof(proof, signals)` | Verify proof object directly |
| `verifyAllProofs()` | Verify all proofs and show results |
| `getAllProofs()` | Get all proofs as array |
| `getProof(sessionId)` | Get specific proof |
| `dumpGNSS()` | Show all sessions in table |
| `downloadAllProofs()` | Download all proofs as JSON |
| `downloadProof(sessionId)` | Download specific proof |

## Tips

- Use `verifyProofById()` for detailed output
- Use `verifyAllProofs()` to batch verify
- Public signals should be `["1"]` if location was inside
- Verification is fast (< 100ms)
- Proof generation is slow (10-30s)
- All data is stored in IndexedDB (persists across sessions)
